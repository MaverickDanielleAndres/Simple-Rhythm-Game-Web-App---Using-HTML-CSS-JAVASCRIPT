<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhythm Master - Beat Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            overflow: hidden;
        }
        .game-container {
            width: 600px;
            height: 580px;
            background: rgba(10, 15, 30, 0.8);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            border: 2px solid #4cc9f0;
        }
        .header {
            text-align: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 2px solid #4361ee;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 3px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee, #7209b7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 8px rgba(76, 201, 240, 0.3);
        }
        .subtitle {
            font-size: 0.9rem;
            color: #a9d6e5;
        }
        .game-area {
            display: flex;
            height: 350px;
            padding: 15px;
        }
        .lanes {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
        }
        .lane {
            flex: 1;
            position: relative;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .lane:first-child {
            border-left: none;
        }
        .lane:last-child {
            border-right: none;
        }
        .target-zone {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
            background: rgba(67, 97, 238, 0.3);
            border-top: 2px solid #4361ee;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        .key-indicator {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: bold;
            color: #4cc9f0;
            border: 2px solid #4cc9f0;
        }
        .beat {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
            box-shadow: 0 0 12px rgba(76, 201, 240, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            animation: fall linear;
            z-index: 5;
        }
        @keyframes fall {
            to {
                top: 350px;
            }
        }
        .stats {
            width: 150px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-left: 2px solid #4361ee;
        }
        .stat-box {
            background: rgba(67, 97, 238, 0.2);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4cc9f0;
            margin: 5px 0;
        }
        .stat-label {
            font-size: 0.8rem;
            color: #a9d6e5;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(45deg, #4361ee, #7209b7);
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        button:active {
            transform: translateY(1px);
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .instructions {
            text-align: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-top: 2px solid #4361ee;
            font-size: 0.9rem;
            color: #a9d6e5;
        }
        .key-hint {
            display: inline-block;
            background: rgba(67, 97, 238, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            margin: 0 3px;
            font-weight: bold;
        }
        .feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
            text-shadow: 0 0 15px currentColor;
        }
        .perfect {
            color: #4cc9f0;
        }
        .good {
            color: #4ade80;
        }
        .miss {
            color: #f87171;
        }
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 30, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .game-over.active {
            opacity: 1;
            pointer-events: all;
        }
        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #fbbf24, #f87171);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .final-score {
            font-size: 2rem;
            margin: 15px 0;
            color: #4cc9f0;
        }
        .pulse {
            animation: pulse 0.5s ease;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .glow {
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.8);
        }
        .progress-bar {
            height: 4px;
            background: #4361ee;
            width: 0%;
            transition: width 0.1s linear;
        }
        .music-note {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0;
            z-index: 1;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>RHYTHM MASTER</h1>
            <div class="subtitle">Press keys when beats reach the target zone!</div>
        </div>
        <div class="progress-bar" id="progressBar"></div>
        <div class="game-area">
            <div class="lanes">
                <div class="lane" id="lane1">
                    <div class="target-zone">
                        <div class="key-indicator">D</div>
                    </div>
                </div>
                <div class="lane" id="lane2">
                    <div class="target-zone">
                        <div class="key-indicator">F</div>
                    </div>
                </div>
                <div class="lane" id="lane3">
                    <div class="target-zone">
                        <div class="key-indicator">J</div>
                    </div>
                </div>
                <div class="lane" id="lane4">
                    <div class="target-zone">
                        <div class="key-indicator">K</div>
                    </div>
                </div>
            </div>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="score">0</div>
                    <div class="stat-label">SCORE</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="bestScore">0</div>
                    <div class="stat-label">BEST</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="accuracy">100%</div>
                    <div class="stat-label">ACCURACY</div>
                </div>
            </div>
        </div>
        <div class="instructions">
            Press <span class="key-hint">D</span> <span class="key-hint">F</span> <span class="key-hint">J</span> <span class="key-hint">K</span> when beats reach the blue target zone
        </div>
        <div class="controls">
            <button id="startBtn">START GAME</button>
            <button id="resetBtn">RESET</button>
        </div>
        <div class="feedback perfect" id="perfect">PERFECT!</div>
        <div class="feedback good" id="good">GOOD!</div>
        <div class="feedback miss" id="miss">MISS!</div>
        <div class="game-over" id="gameOver">
            <h2>GAME OVER</h2>
            <div class="final-score">Score: <span id="finalScore">0</span></div>
            <div class="final-score">Best Score: <span id="finalBestScore">0</span></div>
            <div class="final-score" style="margin-bottom: 50px;">Accuracy: <span id="finalAccuracy">100%</span></div>
            <button id="playAgainBtn">PLAY AGAIN</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Game elements
            const lanes = document.querySelectorAll('.lane');
            const scoreDisplay = document.getElementById('score');
            const bestScoreDisplay = document.getElementById('bestScore');
            const accuracyDisplay = document.getElementById('accuracy');
            const startBtn = document.getElementById('startBtn');
            const resetBtn = document.getElementById('resetBtn');
            const playAgainBtn = document.getElementById('playAgainBtn');
            const gameOverScreen = document.getElementById('gameOver');
            const finalScore = document.getElementById('finalScore');
            const finalBestScore = document.getElementById('finalBestScore');
            const finalAccuracy = document.getElementById('finalAccuracy');
            const progressBar = document.getElementById('progressBar');
            // Feedback elements
            const perfectFeedback = document.getElementById('perfect');
            const goodFeedback = document.getElementById('good');
            const missFeedback = document.getElementById('miss');
            // Game state
            let score = 0;
            let bestScore = localStorage.getItem('bestScore') || 0;
            let hits = 0;
            let totalNotes = 0;
            let gameActive = false;
            let gamePaused = false;
            let beatInterval;
            let gameDuration = 45; // seconds
            let timeLeft = gameDuration;
            let audioContext;
            let oscillator;
            // Key mapping
            const keys = ['d', 'f', 'j', 'k'];
            const keyElements = {
                'd': document.querySelector('#lane1 .key-indicator'),
                'f': document.querySelector('#lane2 .key-indicator'),
                'j': document.querySelector('#lane3 .key-indicator'),
                'k': document.querySelector('#lane4 .key-indicator')
            };
            // Initialize best score display
            bestScoreDisplay.textContent = bestScore;
            finalBestScore.textContent = bestScore;
            // Initialize Web Audio API
            function initAudio() {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    return true;
                } catch (e) {
                    console.error("Web Audio API is not supported in this browser");
                    return false;
                }
            }
            // Play sound effect
            function playSound(frequency, type = 'sine', duration = 0.1) {
                if (!audioContext) return;
                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.type = type;
                    oscillator.frequency.value = frequency;
                    gainNode.gain.value = 0.3;
                    oscillator.start();
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                    oscillator.stop(audioContext.currentTime + duration);
                } catch (e) {
                    console.log("Error playing sound:", e);
                }
            }
            // Play background music
            function playBackgroundMusic() {
                if (!audioContext) return;
                // Simple beat pattern
                const beatPattern = [200, 0, 200, 0, 200, 0, 200, 300];
                let beatIndex = 0;
                const playBeat = () => {
                    if (!gameActive || gamePaused) return;
                    const freq = beatPattern[beatIndex];
                    if (freq > 0) {
                        playSound(freq, 'square', 0.2);
                    }
                    beatIndex = (beatIndex + 1) % beatPattern.length;
                    setTimeout(playBeat, 300); // 300ms per beat
                };
                playBeat();
            }
            // Initialize game
            function initGame() {
                resetGame();
                startBtn.textContent = "PAUSE";
                gameActive = true;
                gamePaused = false;
                timeLeft = gameDuration;
                updateProgressBar();
                // Start beat generation
                startBeatGeneration();
                // Start background music
                playBackgroundMusic();
                // Start timer
                const timer = setInterval(() => {
                    if (!gameActive) {
                        clearInterval(timer);
                        return;
                    }
                    if (!gamePaused) {
                        timeLeft--;
                        updateProgressBar();
                        if (timeLeft <= 0) {
                            clearInterval(timer);
                            endGame();
                        }
                    }
                }, 1000);
            }
            // Reset game state
            function resetGame() {
                // Clear existing beats
                document.querySelectorAll('.beat').forEach(beat => beat.remove());
                document.querySelectorAll('.music-note').forEach(note => note.remove());
                // Reset game state
                score = 0;
                hits = 0;
                totalNotes = 0;
                gameActive = false;
                gamePaused = false;
                // Update displays
                updateDisplays();
                progressBar.style.width = "0%";
                // Clear intervals
                clearInterval(beatInterval);
                // Hide game over screen
                gameOverScreen.classList.remove('active');
                // Reset button text
                startBtn.textContent = "START GAME";
                startBtn.disabled = false;
            }
            // Pause/resume game
            function togglePause() {
                if (!gameActive) return;
                gamePaused = !gamePaused;
                startBtn.textContent = gamePaused ? "RESUME" : "PAUSE";
                if (gamePaused) {
                    // Pause all animations
                    document.querySelectorAll('.beat').forEach(beat => {
                        beat.style.animationPlayState = 'paused';
                    });
                } else {
                    // Resume all animations
                    document.querySelectorAll('.beat').forEach(beat => {
                        beat.style.animationPlayState = 'running';
                    });
                }
            }
            // Update progress bar
            function updateProgressBar() {
                const progress = ((gameDuration - timeLeft) / gameDuration) * 100;
                progressBar.style.width = `${progress}%`;
            }
            // Start generating beats
            function startBeatGeneration() {
                beatInterval = setInterval(() => {
                    if (gameActive && !gamePaused) {
                        generateBeat();
                    }
                }, 600); // Generate a beat every 600ms
            }
            // Generate a beat in a random lane
            function generateBeat() {
                const laneIndex = Math.floor(Math.random() * lanes.length);
                const lane = lanes[laneIndex];
                const key = keys[laneIndex];
                const beat = document.createElement('div');
                beat.className = 'beat';
                beat.textContent = key.toUpperCase();
                beat.dataset.key = key;
                beat.dataset.lane = laneIndex;
                // Set animation duration based on game speed
                const gameSpeed = 1800; // milliseconds for a beat to fall
                beat.style.animation = `fall ${gameSpeed}ms linear`;
                // Pause animation if game is paused
                if (gamePaused) {
                    beat.style.animationPlayState = 'paused';
                }
                lane.appendChild(beat);
                // Remove beat after animation completes
                setTimeout(() => {
                    if (beat.parentNode) {
                        beat.remove();
                        // Missed the beat
                        if (gameActive && !gamePaused) {
                            showFeedback('miss');
                            playSound(150, 'sawtooth', 0.2); // Miss sound
                            updateDisplays();
                        }
                    }
                }, gameSpeed);
                totalNotes++;
            }
            // Handle key press
            function handleKeyPress(e) {
                if (!gameActive || gamePaused) return;
                const key = e.key.toLowerCase();
                if (!keys.includes(key)) return;
                // Highlight the pressed key
                keyElements[key].classList.add('glow');
                setTimeout(() => {
                    keyElements[key].classList.remove('glow');
                }, 100);
                // Play key sound
                const frequencies = {'d': 330, 'f': 392, 'j': 440, 'k': 523};
                playSound(frequencies[key], 'sine', 0.2);
                // Check for hits
                checkHit(key);
            }
            // Check if a beat was hit
            function checkHit(key) {
                const laneIndex = keys.indexOf(key);
                const lane = lanes[laneIndex];
                // Find the lowest beat in this lane (closest to target)
                const beats = lane.querySelectorAll('.beat');
                if (beats.length === 0) return;
                const beat = beats[0]; // First beat (closest to target)
                const beatRect = beat.getBoundingClientRect();
                const targetRect = lane.querySelector('.target-zone').getBoundingClientRect();
                // Calculate distance from target
                const beatCenter = beatRect.top + beatRect.height / 2;
                const targetCenter = targetRect.top + targetRect.height / 2;
                const distance = Math.abs(beatCenter - targetCenter);
                // Determine hit accuracy
                const hitZone = 30; // pixels
                const goodZone = 60; // pixels
                if (distance <= hitZone) {
                    // Perfect hit
                    score += 100;
                    hits++;
                    showFeedback('perfect');
                    playSound(523, 'sine', 0.2); // Perfect sound
                    createMusicNotes(beat);
                    beat.remove();
                } else if (distance <= goodZone) {
                    // Good hit
                    score += 50;
                    hits++;
                    showFeedback('good');
                    playSound(440, 'sine', 0.2); // Good sound
                    createMusicNotes(beat);
                    beat.remove();
                } else {
                    // Miss
                    showFeedback('miss');
                    playSound(150, 'sawtooth', 0.2); // Miss sound
                }
                updateDisplays();
            }
            // Create music notes effect
            function createMusicNotes(element) {
                const rect = element.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                for (let i = 0; i < 5; i++) {
                    const note = document.createElement('div');
                    note.className = 'music-note';
                    note.innerHTML = '♪';
                    note.style.left = `${x}px`;
                    note.style.top = `${y}px`;
                    note.style.color = `hsl(${Math.random() * 360}, 100%, 70%)`;
                    document.body.appendChild(note);
                    // Animate note
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 40 + Math.random() * 80;
                    const duration = 800 + Math.random() * 800;
                    note.animate([
                        { transform: 'translate(0, 0)', opacity: 1 },
                        { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`, opacity: 0 }
                    ], {
                        duration: duration,
                        easing: 'ease-out'
                    });
                    // Remove note after animation
                    setTimeout(() => {
                        if (note.parentNode) {
                            note.parentNode.removeChild(note);
                        }
                    }, duration);
                }
            }
            // Show feedback animation
            function showFeedback(type) {
                const feedback = document.getElementById(type);
                feedback.style.opacity = "1";
                feedback.classList.add('pulse');
                setTimeout(() => {
                    feedback.style.opacity = "0";
                    feedback.classList.remove('pulse');
                }, 500);
            }
            // Update displays
            function updateDisplays() {
                scoreDisplay.textContent = score;
                // Calculate accuracy
                const accuracy = totalNotes > 0 ? Math.round((hits / totalNotes) * 100) : 100;
                accuracyDisplay.textContent = `${accuracy}%`;
            }
            // End the game
            function endGame() {
                gameActive = false;
                gamePaused = false;
                clearInterval(beatInterval);
                // Calculate final stats
                const accuracy = totalNotes > 0 ? Math.round((hits / totalNotes) * 100) : 100;
                // Update best score if needed
                if (score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('bestScore', bestScore);
                    bestScoreDisplay.textContent = bestScore;
                }
                // Update final score display
                finalScore.textContent = score;
                finalBestScore.textContent = bestScore;
                finalAccuracy.textContent = `${accuracy}%`;
                // Show game over screen
                setTimeout(() => {
                    gameOverScreen.classList.add('active');
                }, 1000);
            }
            // Event listeners
            startBtn.addEventListener('click', () => {
                if (!audioContext) {
                    if (!initAudio()) {
                        alert("Web Audio API is not supported in your browser. Please try a modern browser.");
                        return;
                    }
                }
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                if (!gameActive) {
                    initGame();
                } else {
                    togglePause();
                }
            });
            resetBtn.addEventListener('click', resetGame);
            playAgainBtn.addEventListener('click', () => {
                gameOverScreen.classList.remove('active');
                initGame();
            });
            document.addEventListener('keydown', handleKeyPress);
            // Initialize audio on first interaction
            document.body.addEventListener('click', () => {
                if (!audioContext) {
                    initAudio();
                }
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }, { once: true });
        });
    </script>
</body>

</html>
